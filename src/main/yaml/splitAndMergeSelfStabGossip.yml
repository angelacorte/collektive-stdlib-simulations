incarnation: collektive

variables:
  fileName: &fileName
    "self-stab-gossip-sm"
  path: &path
    "data/self-stab-gossip-sm"
  seed: &seed
    min: 0
    max: 1
#      formula: System.getenv("MAX_SEED").toDouble()
#      language: kotlin
    step: 1
    default: 42
  initialNodes: &initialNodes
    type: ArbitraryVariable
    parameters: [ 50, [ 1, 2, 10, 100, 300, 500 ] ]
  movingRange: &movingRange
    5.0
  width: &width
    10
  leftStart: &leftStart
    0
  height: &height
    20

seeds:
  scenario: *seed
  simulation: *seed

network-model:
  type: ConnectWithinDistance
  parameters: [4]

_pool: &program
  - time-distribution: 1
    type: Event
    actions:
      - type: RunCollektiveProgram
        parameters: [ it.unibo.collektive.experiments.SplitAndMergeKt.splitAndMergeSelfStabGossip ]

_divide: &divide
  - time-distribution:
      type: Trigger
      parameters: [ 200 ]
    type: Event
    actions:
      - type: MoveCluster
        parameters: [ *movingRange ]

_merging: &merging
  - time-distribution:
      type: Trigger
      parameters: [ 600 ]
    type: Event
    actions:
      - type: MoveCluster
        parameters: [ -5 ]


deployments:
  - type: Rectangle
    parameters: [*initialNodes, *leftStart, 0, *width, *height]
    programs:
      - *program
    properties:
      - type: it.unibo.collektive.alchemist.device.sensors.impl.TimeSensorProperty
      - type: it.unibo.collektive.alchemist.device.sensors.impl.RandomNodeProperty
  - type: Rectangle
    parameters: [*initialNodes, *width, 0, *width, *height]
    programs:
      - *program
      - *divide
      - *merging
    properties:
      - type: it.unibo.collektive.alchemist.device.sensors.impl.TimeSensorProperty
      - type: it.unibo.collektive.alchemist.device.sensors.impl.RandomNodeProperty

terminate:
  type: AfterTime
  parameters: 800

export:
  - type: CSVExporter
    parameters:
      fileNameRoot: *fileName
      interval: 1.0
      exportPath: *path
    data:
      - time
      - molecule: best-value
        aggregators: [ min, max, mean, StandardDeviation ]
        value-filter: onlyfinite
        precision: 3
      - type: NumberOfNodes
      - type: NetworkDensity
      - molecule: MessageSize
        aggregators: [ max, mean, variance, median, StandardDeviation ]
        value-filter: onlyfinite
        precision: 3
      - molecule: MessageSize
        aggregators: [ Sum ]